{% extends "app.html" %}

{% block content %}
<!-- Header da pagina -->
<div class="page-header">
    <div class="page-header-left">
        <a href="/projetos/{{ projeto.id }}" class="btn-back" title="Voltar para o projeto">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </a>
        <div>
            <h1 class="page-title">{{ projeto.titulo }}</h1>
            <p class="page-subtitle">Editar {{ campos_config|length and 'campos do ' or '' }}{{
                page_title.replace('Editar ', '') }}</p>
        </div>
    </div>
    <div class="page-header-right">
        <span class="versao-badge">Versao {{ artefato.versao }}</span>
        {# Nova Versão: só aparece se NÃO existe versão aprovada #}
        {% if not has_any_approved %}
        <button type="button" id="btn-nova-versao" class="btn btn-secondary btn-sm">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <path d="M12 5v14M5 12h14" />
            </svg>
            Nova Versao
        </button>
        {% endif %}
    </div>
</div>

<!-- Barra de acoes -->
<div class="card artefato-actions-bar">
    <div class="actions-left">
        <span class="status-indicator">
            <span class="status-dot status-{{ artefato.status }}"></span>
            {{ artefato.status|replace('_', ' ')|title }}
        </span>
        <span class="separator">|</span>
        <span class="last-update">Atualizado em {{ artefato.data_atualizacao.strftime('%d/%m/%Y %H:%M') }}</span>
    </div>
    <div class="actions-right">
        {# 
          Regras do botão Aprovar:
          - Se já está aprovado: mostrar "Aprovado" disabled
          - Se existe OUTRA versão aprovada: mostrar "Bloqueado" disabled
          - Senão: mostrar "Aprovar" habilitado
        #}
        {% if artefato.status == 'aprovado' %}
        <button type="button" class="btn btn-ghost btn-sm" id="btn-aprovar" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            Aprovado
        </button>
        {% elif has_other_approved %}
        <button type="button" class="btn btn-ghost btn-sm" disabled title="Já existe outra versão aprovada">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            Bloqueado
        </button>
        {% else %}
        <button type="button" class="btn btn-ghost btn-sm" id="btn-aprovar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            Aprovar
        </button>
        {% endif %}
    </div>
</div>

<!-- Formulario de edicao -->
<div class="artefato-editor">
    {% for campo_nome, campo_config in campos_config.items() %}
    <div class="artefato-field-card" data-campo="{{ campo_nome }}" data-tipo="{{ campo_config.tipo }}">
        <div class="field-header">
            <div class="field-info">
                <h3 class="field-label">{{ campo_config.label }}</h3>
                <p class="field-description">{{ campo_config.get('descricao', '') }}</p>
            </div>
            <div class="field-actions">
                {% if campo_config.tipo == 'B' %}
                <button type="button" class="btn btn-ghost btn-sm btn-regenerar" data-campo="{{ campo_nome }}"
                    title="Regenerar com IA">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                    </svg>
                    IA
                </button>
                {% endif %}
                <button type="button" class="btn btn-ghost btn-sm btn-salvar-campo" data-campo="{{ campo_nome }}"
                    title="Salvar alteracoes" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                        <polyline points="17 21 17 13 7 13 7 21" />
                        <polyline points="7 3 7 8 15 8" />
                    </svg>
                    Salvar
                </button>
            </div>
        </div>

        <div class="field-content">
            {% if campo_config.get('input_type') == 'number' %}
            <input type="text" id="campo-{{ campo_nome }}" class="field-input campo-editavel"
                data-campo="{{ campo_nome }}" value="{{ artefato[campo_nome] if artefato[campo_nome] else '' }}"
                placeholder="{{ campo_config.get('placeholder', '') }}" />
            {% elif campo_config.get('input_type') == 'json' %}
            <textarea id="campo-{{ campo_nome }}" class="field-textarea campo-editavel campo-json hidden-json-source"
                data-campo="{{ campo_nome }}" rows="8"
                placeholder="{{ campo_config.get('placeholder', 'JSON estruturado...') }}"
                style="display: none;">{{ artefato[campo_nome]|tojson if artefato[campo_nome] else '' }}</textarea>
            <div id="json-editor-{{ campo_nome }}" class="json-cards-container"></div>
            {% else %}
            <textarea id="campo-{{ campo_nome }}" class="field-textarea campo-editavel" data-campo="{{ campo_nome }}"
                rows="{{ 3 if campo_config.tipo == 'A' else 6 }}"
                placeholder="{{ campo_config.get('placeholder', '') }}">{{ artefato[campo_nome] if artefato[campo_nome] else '' }}</textarea>
            {% endif %}
        </div>

        {% if campo_config.tipo == 'B' %}
        <div class="field-ia-panel" id="ia-panel-{{ campo_nome }}" style="display: none;">
            <div class="ia-panel-header">
                <span>Regenerar com Inteligencia Artificial</span>
                <button type="button" class="btn-close-panel" data-campo="{{ campo_nome }}">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="ia-panel-content">
                <textarea id="prompt-{{ campo_nome }}" class="ia-prompt-input" rows="2"
                    placeholder="Instrucoes adicionais para a IA (opcional)..."></textarea>
                <button type="button" class="btn btn-primary btn-sm btn-enviar-ia" data-campo="{{ campo_nome }}">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                    </svg>
                    Regenerar Campo
                </button>
            </div>
        </div>
        {% endif %}

        <div class="field-loading" id="loading-{{ campo_nome }}" style="display: none;">
            <div class="loading-spinner-small"></div>
            <span>Processando...</span>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    const ARTEFATO_ID = {{ artefato.id }};
    const PROJETO_ID = {{ projeto.id }};
    const TIPO_ARTEFATO = "{{ tipo_artefato }}";
    const CAMPOS_CONFIG = {{ campos_config_json| safe }};

    // Inicializar editores JSON com abas
    document.querySelectorAll('.hidden-json-source').forEach(initJsonEditor);

    // Armazenar valores originais para detectar alteracoes
    const valoresOriginais = {};
    document.querySelectorAll('.campo-editavel').forEach(el => {
        valoresOriginais[el.dataset.campo] = el.value;
    });

    // Detectar alteracoes nos campos
    document.querySelectorAll('.campo-editavel').forEach(el => {
        el.addEventListener('input', function () {
            const campo = this.dataset.campo;
            const btnSalvar = document.querySelector(`.btn-salvar-campo[data-campo="${campo}"]`);

            if (this.value !== valoresOriginais[campo]) {
                btnSalvar.style.display = 'inline-flex';
                this.closest('.artefato-field-card').classList.add('modificado');
            } else {
                btnSalvar.style.display = 'none';
                this.closest('.artefato-field-card').classList.remove('modificado');
            }
        });
    });

    // Salvar campo manualmente
    document.querySelectorAll('.btn-salvar-campo').forEach(btn => {
        btn.addEventListener('click', async function () {
            const campo = this.dataset.campo;
            const input = document.getElementById(`campo-${campo}`);
            const loading = document.getElementById(`loading-${campo}`);

            loading.style.display = 'flex';
            this.disabled = true;

            try {
                const response = await fetch(`/api/${TIPO_ARTEFATO}/editar-campo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        artefato_id: ARTEFATO_ID,
                        campo: campo,
                        valor: input.value
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Erro ao salvar');
                }

                const result = await response.json();

                // Atualizar valor original
                valoresOriginais[campo] = input.value;
                this.style.display = 'none';
                input.closest('.artefato-field-card').classList.remove('modificado');

                mostrarNotificacao('Campo salvo com sucesso!', 'success');

            } catch (error) {
                console.error('Erro:', error);
                mostrarNotificacao('Erro ao salvar: ' + error.message, 'error');
            } finally {
                loading.style.display = 'none';
                this.disabled = false;
            }
        });
    });

    // Abrir painel de IA
    document.querySelectorAll('.btn-regenerar').forEach(btn => {
        btn.addEventListener('click', function () {
            const campo = this.dataset.campo;
            const panel = document.getElementById(`ia-panel-${campo}`);
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        });
    });

    // Fechar painel de IA
    document.querySelectorAll('.btn-close-panel').forEach(btn => {
        btn.addEventListener('click', function () {
            const campo = this.dataset.campo;
            document.getElementById(`ia-panel-${campo}`).style.display = 'none';
        });
    });

    // Regenerar campo com IA
    document.querySelectorAll('.btn-enviar-ia').forEach(btn => {
        btn.addEventListener('click', async function () {
            const campo = this.dataset.campo;
            const prompt = document.getElementById(`prompt-${campo}`).value;
            const loading = document.getElementById(`loading-${campo}`);
            const input = document.getElementById(`campo-${campo}`);

            loading.style.display = 'flex';
            this.disabled = true;

            try {
                const response = await fetch(`/api/${TIPO_ARTEFATO}/regenerar-campo-ia`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        artefato_id: ARTEFATO_ID,
                        campo: campo,
                        prompt_adicional: prompt
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Erro ao regenerar');
                }

                const result = await response.json();

                // Atualizar campo com novo valor
                input.value = result.valor;
                valoresOriginais[campo] = result.valor;

                // Fechar painel
                document.getElementById(`ia-panel-${campo}`).style.display = 'none';
                document.getElementById(`prompt-${campo}`).value = '';

                mostrarNotificacao('Campo regenerado com sucesso!', 'success');

            } catch (error) {
                console.error('Erro:', error);
                mostrarNotificacao('Erro ao regenerar: ' + error.message, 'error');
            } finally {
                loading.style.display = 'none';
                this.disabled = false;
            }
        });
    });

    // Nova versao (só existe se não há versão aprovada)
    document.getElementById('btn-nova-versao')?.addEventListener('click', async function () {
        if (!confirm('Criar uma nova versao? A versao atual sera salva no historico.')) {
            return;
        }

        try {
            const response = await fetch(`/api/${TIPO_ARTEFATO}/${ARTEFATO_ID}/nova-versao`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'Erro ao criar versao');
            }

            const result = await response.json();
            mostrarNotificacao(`Nova versao ${result.versao_atual} criada!`, 'success');

            setTimeout(() => location.reload(), 1000);

        } catch (error) {
            console.error('Erro:', error);
            mostrarNotificacao('Erro ao criar versao: ' + error.message, 'error');
        }
    });

    // Aprovar artefato
    document.getElementById('btn-aprovar')?.addEventListener('click', async function () {
        if (this.disabled) return;

        if (!confirm('Aprovar este documento? O status sera alterado para "aprovado".')) {
            return;
        }

        try {
            const response = await fetch(`/api/${TIPO_ARTEFATO}/${ARTEFATO_ID}/aprovar`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'Erro ao aprovar');
            }

            mostrarNotificacao('Documento aprovado com sucesso!', 'success');
            setTimeout(() => window.location.href = `/projetos/${PROJETO_ID}`, 1000);

        } catch (error) {
            console.error('Erro:', error);
            mostrarNotificacao('Erro ao aprovar: ' + error.message, 'error');
        }
    });

    // Funcao de notificacao
    function mostrarNotificacao(mensagem, tipo) {
        const notif = document.createElement('div');
        notif.className = `notificacao notificacao-${tipo}`;
        notif.innerHTML = `
        <span>${mensagem}</span>
        <button onclick="this.parentElement.remove()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    `;
        document.body.appendChild(notif);

        setTimeout(() => notif.remove(), 5000);
    }

    // Editor JSON com Cards (Estilo DFD)
    function initJsonEditor(textarea) {
        const container = document.getElementById(`json-editor-${textarea.dataset.campo}`);
        const mainField = textarea.dataset.campo;
        let data = {};

        try {
            // Tenta fazer parse do valor. Se for string vazia, usa {}
            const val = textarea.value || '{}';
            // Se o valor vier com aspas extras (string de string), tenta limpar
            data = JSON.parse(val);
            // Se o resultado for string, faz parse de novo (caso de double encoding)
            if (typeof data === 'string') data = JSON.parse(data);
        } catch (e) {
            console.error('Erro ao ler JSON', e);
            textarea.style.display = 'block'; // Fallback
            return;
        }

        if (typeof data !== 'object' || data === null || Array.isArray(data)) {
            textarea.style.display = 'block';
            return;
        }

        const keys = Object.keys(data);
        if (keys.length === 0) {
            textarea.style.display = 'block';
            return;
        }

        // Criar estrutura de abas
        const tabsHeader = document.createElement('div');
        tabsHeader.className = 'json-tabs-header';

        const tabsContent = document.createElement('div');
        tabsContent.className = 'json-tabs-content';

        keys.forEach((key, index) => {
            // Botao da aba
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = `json-tab-btn ${index === 0 ? 'active' : ''}`;
            btn.textContent = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

            btn.addEventListener('click', () => {
                container.querySelectorAll('.json-tab-btn').forEach(b => b.classList.remove('active'));
                container.querySelectorAll('.json-tab-pane').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                container.querySelector(`.json-tab-pane[data-key="${key}"]`).classList.add('active');
            });

            tabsHeader.appendChild(btn);

            // Conteudo da aba
            const pane = document.createElement('div');
            pane.className = `json-tab-pane ${index === 0 ? 'active' : ''}`;
            pane.dataset.key = key;

            const subTextarea = document.createElement('textarea');
            subTextarea.className = 'field-textarea json-sub-editor';
            subTextarea.rows = 15;
            subTextarea.value = JSON.stringify(data[key], null, 2);

            // Sincronizar com o textarea principal
            subTextarea.addEventListener('input', () => {
                try {
                    data[key] = JSON.parse(subTextarea.value);
                    textarea.value = JSON.stringify(data);
                    textarea.dispatchEvent(new Event('input')); // Disparar evento para habilitar botao salvar
                    subTextarea.style.borderColor = '';
                } catch (e) {
                    subTextarea.style.borderColor = '#E53E3E'; // Vermelho se JSON invalido
                }
            });

            pane.appendChild(subTextarea);
            tabsContent.appendChild(pane);
        });

        container.appendChild(tabsHeader);
        container.appendChild(tabsContent);
    }
</script>

<style>
    /* Header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-lg);
    }

    .page-header-left {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-md);
    }

    .page-header-right {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .btn-back {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: var(--radius-md);
        background: var(--bg-secondary);
        color: var(--text-secondary);
        transition: var(--transition);
    }

    .btn-back:hover {
        background: var(--color-primary);
        color: white;
    }

    .btn-back svg {
        width: 20px;
        height: 20px;
    }

    .versao-badge {
        background: var(--color-primary);
        color: white;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        font-weight: 500;
    }

    /* Barra de acoes */
    .artefato-actions-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md) var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
    }

    .actions-left {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .status-indicator {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .status-dot.status-rascunho {
        background: var(--color-warning);
    }

    .status-dot.status-em_revisao {
        background: var(--color-info);
    }

    .status-dot.status-aprovado {
        background: var(--color-success);
    }

    .separator {
        color: var(--text-tertiary);
    }

    .last-update {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    /* Editor */
    .artefato-editor {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
    }

    .artefato-field-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        transition: var(--transition);
    }

    .artefato-field-card.modificado {
        border-color: var(--color-warning);
        box-shadow: 0 0 0 2px rgba(236, 201, 75, 0.2);
    }

    .field-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-md);
    }

    .field-label {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .field-description {
        font-size: 0.8125rem;
        color: var(--text-secondary);
    }

    .field-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .field-content {
        margin-bottom: var(--spacing-sm);
    }

    .field-textarea,
    .field-input {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: 0.9375rem;
        line-height: 1.6;
        background: var(--bg-primary);
        color: var(--text-primary);
        resize: vertical;
        transition: var(--transition);
    }

    .field-textarea:focus,
    .field-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px rgba(44, 122, 123, 0.1);
    }

    .campo-json {
        font-family: monospace;
        font-size: 0.8125rem;
    }

    /* Painel de IA */
    .field-ia-panel {
        margin-top: var(--spacing-md);
        padding: var(--spacing-md);
        background: linear-gradient(135deg, rgba(44, 122, 123, 0.05) 0%, rgba(44, 122, 123, 0.1) 100%);
        border-radius: var(--radius-md);
        border: 1px solid var(--color-primary-light);
    }

    .ia-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
        font-weight: 500;
        color: var(--color-primary);
    }

    .btn-close-panel {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.25rem;
        color: var(--text-secondary);
    }

    .ia-prompt-input {
        width: 100%;
        padding: var(--spacing-sm);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        font-family: inherit;
        font-size: 0.875rem;
        margin-bottom: var(--spacing-sm);
        background: var(--bg-secondary);
        color: var(--text-primary);
        resize: none;
    }

    /* Loading */
    .field-loading {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm);
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .loading-spinner-small {
        width: 16px;
        height: 16px;
        border: 2px solid var(--color-gray-200);
        border-top-color: var(--color-primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* Notificacoes */
    .notificacao {
        position: fixed;
        bottom: var(--spacing-lg);
        right: var(--spacing-lg);
        padding: var(--spacing-md) var(--spacing-lg);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        box-shadow: var(--shadow-lg);
        z-index: 2000;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }

        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .notificacao-success {
        background: #C6F6D5;
        color: #22543D;
    }

    .notificacao-error {
        background: #FED7D7;
        color: #C53030;
    }

    .notificacao button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        color: inherit;
        opacity: 0.7;
    }

    .notificacao button:hover {
        opacity: 1;
    }

    /* Responsivo */
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .page-header-right {
            width: 100%;
            justify-content: flex-end;
        }

        .artefato-actions-bar {
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .json-tabs-header {
            flex-wrap: wrap;
        }
    }

    /* JSON Tabs Styles */
    .json-tabbed-editor {
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        overflow: hidden;
    }

    .json-tabs-header {
        display: flex;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        overflow-x: auto;
    }

    .json-tab-btn {
        padding: 0.75rem 1rem;
        background: none;
        border: none;
        border-right: 1px solid var(--border-color);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-secondary);
        white-space: nowrap;
        transition: var(--transition);
    }

    .json-tab-btn:hover {
        background: rgba(0, 0, 0, 0.02);
        color: var(--color-primary);
    }

    .json-tab-btn.active {
        background: white;
        color: var(--color-primary);
        border-bottom: 2px solid var(--color-primary);
        margin-bottom: -1px;
    }

    .json-tabs-content {
        padding: var(--spacing-md);
        background: white;
    }

    .json-tab-pane {
        display: none;
    }

    .json-tab-pane.active {
        display: block;
    }

    .json-sub-editor {
        font-family: monospace;
        font-size: 0.875rem;
        border: 1px solid var(--border-color);
    }
</style>
{% endblock %}