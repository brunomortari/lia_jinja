{#
Sistema LIA - Artifact Chat Layout Component
=============================================
Template reutiliz√°vel para p√°ginas de gera√ß√£o de artefatos com IA
Usado por: DFD, ETP, TR, Edital, PGR, etc.

VARI√ÅVEIS ESPERADAS:
- artifact_type: 'dfd', 'etp', 'tr', etc.
- artifact_label: 'DFD', 'ETP', 'TR', etc.
- artifact_version: Pr√≥xima vers√£o do artefato
- projeto: Objeto do projeto
- usuario: Objeto do usu√°rio
- context_cards: Lista de cards de contexto (opcional)
- required_fields: Lista de campos obrigat√≥rios no painel (opcional)

BLOCOS DISPON√çVEIS:
- chat_welcome_content: Conte√∫do da tela de boas-vindas
- context_panel_required_fields: Campos obrigat√≥rios personalizados
- context_panel_cards: Cards de contexto personalizados
#}

<div class="artifact-chat-layout phase-preparation" id="artifactChatLayout">
    <!-- SE√á√ÉO DE CHAT -->
    <section class="chat-section" id="chatSection">
        <div class="chat-header">
            <div class="chat-header-info">
                <h1 class="chat-header-title">
                    Projeto {{ projeto.id }}: {{ projeto.titulo }}
                    <span class="chat-header-badge">{{ artifact_label }} v{{ artifact_version }}</span>
                </h1>
                <p class="chat-header-subtitle">{{ chat_subtitle|default('Assistente para elabora√ß√£o de artefato') }}
                </p>
            </div>
        </div>

        <!-- Welcome (shown initially) -->
        <div class="chat-welcome" id="chatWelcome">
            {% block chat_welcome_content %}
            <div class="chat-welcome-icon">ü§ñ</div>
            <h2>LIA - Assistente de Contrata√ß√µes</h2>
            <p>Vou ajud√°-lo a elaborar o artefato conforme a Lei 14.133/2021. Me conte sobre sua necessidade e eu
                cuidarei da fundamenta√ß√£o t√©cnica e legal.</p>
            {% endblock %}
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages"></div>

        <!-- Generate Authorization Bar -->
        <div class="generate-auth-bar" id="generateAuthBar">
            <div class="generate-auth-text">
                <div class="generate-auth-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                    </svg>
                </div>
                <div class="generate-auth-label">
                    <strong>Informa√ß√µes coletadas com sucesso</strong>
                    <span>Autorize a gera√ß√£o do {{ artifact_label }} quando estiver pronto</span>
                </div>
            </div>
            <button class="btn-authorize" id="btnAuthorize" onclick="authorizeGeneration()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
                Gerar {{ artifact_label }}
            </button>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area" id="chatInputArea">
            <div class="chat-input-wrapper">
                <textarea class="chat-input" id="chatInput"
                    placeholder="{{ input_placeholder|default('Descreva sua necessidade...') }}" rows="1"></textarea>
                <button class="btn-send" id="btnSend" title="Enviar mensagem">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </section>

    <!-- PAINEL DE CONTEXTO (DIREITA - FASE PREPARA√á√ÉO) -->
    <aside class="context-panel" id="contextPanel">
        <div class="context-header">
            <div class="context-header-title">
                <div class="context-header-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                </div>
                <div class="context-header-text">
                    <h3>Contexto do Projeto</h3>
                    <p>Dados para elabora√ß√£o do {{ artifact_label }}</p>
                </div>
            </div>
        </div>

        <div class="context-body">
            {% block context_panel_required_fields %}
            <!-- Required Fields Section (if any) -->
            {% endblock %}

            <!-- Habilidades Ativas - Card -->
            <div class="context-card collapsed" id="cardSkills">
                <div class="context-card-header" onclick="toggleContextCard('cardSkills')">
                    <div class="context-card-title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                        Habilidades Ativas
                    </div>
                    <span class="badge-count" id="activeSkillsCount"
                        style="background: var(--color-primary); color: white; border-radius: 10px; padding: 2px 6px; font-size: 10px; margin-left: auto; margin-right: 8px; display: none;">0</span>
                    <svg class="context-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="context-card-body">
                    <div id="skillsListContainer"
                        style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size: 12px; color: var(--text-secondary);">Carregando skills...</span>
                    </div>
                    <div class="skills-manage-link"
                        style="text-align: right; border-top: 1px solid var(--border-color); padding-top: 8px;">
                        <a href="/configuracoes" target="_blank"
                            style="font-size: 11px; text-decoration: none; color: var(--color-primary); display: inline-flex; align-items: center; gap: 4px;">
                            <span>Gerenciar</span>
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>

            {% block context_panel_cards %}
            <!-- Informa√ß√µes do Projeto - COLAPSADO -->
            <div class="context-card collapsed" id="cardProjeto">
                <div class="context-card-header" onclick="toggleContextCard('cardProjeto')">
                    <div class="context-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                            </path>
                        </svg>
                        Projeto
                    </div>
                    <svg class="context-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="context-card-body">
                    <div class="context-item">
                        <div class="context-label">T√≠tulo</div>
                        <div class="context-value">{{ projeto.titulo }}</div>
                    </div>
                    <div class="context-item">
                        <div class="context-label">Requisitante</div>
                        <div class="context-value">{{ usuario.nome }}</div>
                    </div>
                    <div class="context-item">
                        <div class="context-label">Setor</div>
                        <div class="context-value">{{ usuario.setor or 'N√£o informado' }}</div>
                    </div>
                </div>
            </div>
            {% endblock %}
        </div>
    </aside>

    <!-- SE√á√ÉO WORKSPACE (DIREITA - FASE GERA√á√ÉO) -->
    <section class="workspace-section" id="workspaceSection">
        <div class="workspace-header">
            <div class="workspace-header-left">
                <div class="workspace-spinner" id="workspaceSpinner"></div>
                <h2 class="workspace-title">
                    <span id="workspaceTitle">Gerando {{ artifact_label }}...</span>
                    <span class="workspace-badge" id="workspaceBadge">Em progresso</span>
                </h2>
            </div>
            <span class="workspace-progress" id="workspaceProgress">Iniciando...</span>
        </div>

        <div class="workspace-body">
            <div class="artifact-fields-container" id="artifactFieldsContainer">
                <!-- Fields will be rendered here -->
            </div>
        </div>

        <div class="workspace-actions" id="workspaceActions">
            <button class="btn-workspace btn-workspace-outline" onclick="voltarProjeto()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5"></path>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Voltar
            </button>
            <button class="btn-workspace btn-workspace-secondary" onclick="saveArtifact('rascunho')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Salvar Rascunho
            </button>
            <button class="btn-workspace btn-workspace-primary" onclick="saveArtifact('aprovado')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Aprovar {{ artifact_label }}
            </button>
        </div>
    </section>
</div>